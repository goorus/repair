<?php

namespace Application\Migrations;

use Doctrine\DBAL\Migrations\AbstractMigration,
    Doctrine\DBAL\Schema\Schema;

/**
 * Auto-generated Migration: Please modify to your need!
 */
class Version20121218223545 extends AbstractMigration
{
    public function up(Schema $schema)
    {
        // this up() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("CREATE TABLE User (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(255) NOT NULL, login VARCHAR(255) NOT NULL, password VARCHAR(255) NOT NULL, active TINYINT(1) NOT NULL, created DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB");
        $this->addSql("CREATE TABLE news (id INT AUTO_INCREMENT NOT NULL, title VARCHAR(255) NOT NULL, announce LONGTEXT NOT NULL, text LONGTEXT NOT NULL, created DATETIME NOT NULL, updated DATETIME NOT NULL, publicTime DATETIME NOT NULL, newsCategoryId INT DEFAULT NULL, INDEX IDX_1DD3995082D3F67D (newsCategoryId), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB");
        $this->addSql("CREATE TABLE news_category (id INT AUTO_INCREMENT NOT NULL, name VARCHAR(64) NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB");
        $this->addSql("CREATE TABLE news_link (id INT AUTO_INCREMENT NOT NULL, news_id INT DEFAULT NULL, url VARCHAR(255) NOT NULL, text VARCHAR(255) NOT NULL, pos INT DEFAULT NULL, INDEX IDX_E3716F7AB5A459A0 (news_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = InnoDB");
        $this->addSql("ALTER TABLE news ADD CONSTRAINT FK_1DD3995082D3F67D FOREIGN KEY (newsCategoryId) REFERENCES news_category (id)");
        $this->addSql("ALTER TABLE news_link ADD CONSTRAINT FK_E3716F7AB5A459A0 FOREIGN KEY (news_id) REFERENCES news (id)");
    }

    public function down(Schema $schema)
    {
        // this down() migration is autogenerated, please modify it to your needs
        $this->abortIf($this->connection->getDatabasePlatform()->getName() != "mysql");
        
        $this->addSql("ALTER TABLE news_link DROP FOREIGN KEY FK_E3716F7AB5A459A0");
        $this->addSql("ALTER TABLE news DROP FOREIGN KEY FK_1DD3995082D3F67D");
        $this->addSql("DROP TABLE User");
        $this->addSql("DROP TABLE news");
        $this->addSql("DROP TABLE news_category");
        $this->addSql("DROP TABLE news_link");
    }
}
